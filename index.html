<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Juego de memoria divertido y adictivo para entrenar tu mente">
    <meta name="theme-color" content="#1a1a2e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="MemoFlip">
  
  <!-- FORZAR NO CACHE -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <title>MemoFlip - Juego de Memoria</title>
    
    <!-- CABECERA UNIFICADA -->
    <link rel="stylesheet" href="css/unified-header.css">
    <link rel="stylesheet" href="css/global-styles.css">
    <link rel="stylesheet" href="css/world-selector.css?v=20250919080500">
    
    <!-- PWA -->
  <link rel="manifest" href="manifest.json">
    <link rel="icon" href="images/ui/logo.png">
    <link rel="apple-touch-icon" href="images/ui/logo.png">
</head>
<body>
    <div class="app-container">
        <!-- HEADER DIRECTO (sin componente) -->
        <header class="game-hud">
            <div class="hud-content">
                <div class="hud-left"></div>
                
                <div class="hud-center">
                    <img src="images/ui/banner.png" alt="MemoFlip" class="logo-banner">
                </div>
                
                <div class="hud-right">
                    <button class="hud-btn" onclick="window.location.href='trophies.html'" title="Trofeos">
                        <span class="btn-icon">üèÜ</span>
                        <span class="btn-number" id="trophy-count">0</span>
                    </button>
                    
                    <button class="hud-btn" onclick="window.location.href='ranking.html'" title="Ranking">
                        <span class="btn-icon">üèÖ</span>
                    </button>
                    
                    <button class="hud-btn" title="Estrellas">
                        <span class="btn-icon">‚≠ê</span>
                        <span class="btn-number" id="star-count">0</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="worlds-grid">
                <!-- MUNDO OC√âANO -->
                <div class="world-card" onclick="selectWorld('ocean')">
                    <span class="world-icon">üåä</span>
                    <h2 class="world-title">Mundo Oc√©ano</h2>
                    <p class="world-description">Sum√©rgete en las profundidades del oc√©ano y encuentra las criaturas marinas m√°s fascinantes.</p>
                    <div class="world-stats">
                        <div class="stat-item">
                            <div class="stat-label">Estrellas</div>
                            <div class="stat-value" id="ocean-stars">0/12</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Niveles</div>
                            <div class="stat-value">4</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Dificultad</div>
                            <div class="stat-value">F√°cil</div>
                        </div>
                    </div>
                </div>

                <!-- MUNDO ISLA -->
                <div class="world-card locked" onclick="selectWorld('island')">
                    <span class="world-icon">üèùÔ∏è</span>
                    <h2 class="world-title">Isla Tropical</h2>
                    <p class="world-description">Explora una isla tropical llena de vida salvaje y tesoros ocultos.</p>
                    <div class="world-stats">
                        <div class="stat-item">
                            <div class="stat-label">Estrellas</div>
                            <div class="stat-value" id="island-stars">0/16</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Niveles</div>
                            <div class="stat-value">4</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Dificultad</div>
                            <div class="stat-value">Media</div>
                        </div>
                    </div>
                </div>

                <!-- MUNDO VOLC√ÅN -->
                <div class="world-card locked" onclick="selectWorld('volcano')">
                    <span class="world-icon">üåã</span>
                    <h2 class="world-title">Volc√°n Ardiente</h2>
                    <p class="world-description">Desaf√≠a el calor del volc√°n y descubre los secretos de las profundidades.</p>
                    <div class="world-stats">
                        <div class="stat-item">
                            <div class="stat-label">Estrellas</div>
                            <div class="stat-value" id="volcano-stars">0/20</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Niveles</div>
                            <div class="stat-value">4</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Dificultad</div>
                            <div class="stat-value">Dif√≠cil</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- SCRIPTS -->
    <script src="js/constants.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/trophy-system.js"></script>
    
    <script>
        // FUNCIONES DEL MUNDO SELECTOR
        function selectWorld(world) {
            const worldConfig = WORLDS[world.toUpperCase()];
            const requiredStars = worldConfig.requiredStars;
            const currentStars = Storage.getTotalStats().totalStars;
            
            if (currentStars >= requiredStars) {
                // Mundo desbloqueado
                if (world === 'ocean') {
                    window.location.href = 'world-ocean.html';
                } else if (world === 'island') {
                    window.location.href = 'world-island.html';
                } else if (world === 'volcano') {
                    window.location.href = 'world-volcano.html';
                }
            } else {
                // Mundo bloqueado - mostrar modal
                showWorldLockedModal(worldConfig.displayName, requiredStars, currentStars);
            }
        }
        
        // FUNCI√ìN PARA MOSTRAR MODAL DE MUNDO BLOQUEADO
        function showWorldLockedModal(worldName, requiredStars, currentStars) {
            const modal = document.createElement('div');
            modal.className = 'world-locked-modal';
            modal.innerHTML = `
                <div class="modal-backdrop"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>üîí ${worldName} Bloqueado</h2>
                    </div>
                    <div class="modal-body">
                        <p>¬°Este mundo est√° bloqueado!</p>
                        <p>Necesitas <strong>${requiredStars - currentStars} estrellas m√°s</strong> para desbloquearlo.</p>
                        <div class="stars-info">
                            <div class="star-item">
                                <span class="star-icon">‚≠ê</span>
                                <span>Tienes: ${currentStars} estrellas</span>
                            </div>
                            <div class="star-item">
                                <span class="heart-icon">üíñ</span>
                                <span>Necesitas: ${requiredStars} estrellas</span>
                            </div>
                        </div>
                        <p class="motivation">¬°Sigue jugando para conseguir m√°s estrellas!</p>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-btn" onclick="closeWorldLockedModal()">Aceptar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeWorldLockedModal() {
            const modal = document.querySelector('.world-locked-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ACTUALIZAR ESTAD√çSTICAS DE MUNDOS
        function updateWorldStats() {
            const scores = Storage.getScores();
            
            // Calcular estrellas del mundo oc√©ano (niveles 1-4)
            let oceanStars = 0;
            for (let i = WORLDS.OCEAN.startLevel; i <= WORLDS.OCEAN.endLevel; i++) {
                if (scores[i] && scores[i].bestStars > 0) {
                    oceanStars += scores[i].bestStars;
                }
            }
            
            // Actualizar elemento del mundo oc√©ano
            const oceanStarsElement = document.getElementById('ocean-stars');
            if (oceanStarsElement) {
                oceanStarsElement.textContent = oceanStars;
                // FORZAR RE-RENDERIZADO VISUAL
                oceanStarsElement.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    oceanStarsElement.style.transform = 'scale(1)';
                }, 100);
            }
            
            // Calcular estrellas del mundo isla (niveles 5-8)
            let islandStars = 0;
            for (let i = WORLDS.ISLAND.startLevel; i <= WORLDS.ISLAND.endLevel; i++) {
                if (scores[i] && scores[i].bestStars > 0) {
                    islandStars += scores[i].bestStars;
                }
            }
            
            // Actualizar elemento del mundo isla
            const islandStarsElement = document.getElementById('island-stars');
            if (islandStarsElement) {
                islandStarsElement.textContent = islandStars;
                // FORZAR RE-RENDERIZADO VISUAL
                islandStarsElement.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    islandStarsElement.style.transform = 'scale(1)';
                }, 100);
            }
            
            // Calcular estrellas del mundo volc√°n (niveles 9-12)
            let volcanoStars = 0;
            for (let i = WORLDS.VOLCANO.startLevel; i <= WORLDS.VOLCANO.endLevel; i++) {
                if (scores[i] && scores[i].bestStars > 0) {
                    volcanoStars += scores[i].bestStars;
                }
            }
            
            // Actualizar elemento del mundo volc√°n
            const volcanoStarsElement = document.getElementById('volcano-stars');
            if (volcanoStarsElement) {
                volcanoStarsElement.textContent = volcanoStars;
                // FORZAR RE-RENDERIZADO VISUAL
                volcanoStarsElement.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    volcanoStarsElement.style.transform = 'scale(1)';
                }, 100);
            }
            
            // ACTUALIZAR ESTADO DE MUNDOS (BLOQUEADO/DESBLOQUEADO)
            const currentStars = Storage.getTotalStats().totalStars;
            
            // Mundo Isla - requiere estrellas seg√∫n configuraci√≥n
            const islandCard = document.querySelector('.world-card:nth-child(2)');
            if (islandCard) {
                if (currentStars >= WORLDS.ISLAND.requiredStars) {
                    islandCard.classList.remove('locked');
                } else {
                    islandCard.classList.add('locked');
                }
            }
            
            // Mundo Volc√°n - requiere estrellas seg√∫n configuraci√≥n
            const volcanoCard = document.querySelector('.world-card:nth-child(3)');
            if (volcanoCard) {
                if (currentStars >= WORLDS.VOLCANO.requiredStars) {
                    volcanoCard.classList.remove('locked');
                } else {
                    volcanoCard.classList.add('locked');
                }
            }
        }
        
        // ACTUALIZAR ESTAD√çSTICAS DEL HEADER
        function updateHeaderStats() {
            const stats = Storage.getTotalStats();
            
            const starCountElement = document.getElementById('star-count');
            if (starCountElement) {
                starCountElement.textContent = stats.totalStars;
            }
            
            const trophyCountElement = document.getElementById('trophy-count');
            if (trophyCountElement) {
                trophyCountElement.textContent = stats.totalTrophies;
            }
        }
        
        // DETECTAR CUANDO SE REGRESA DEL JUEGO Y ACTUALIZAR ESTAD√çSTICAS
        window.addEventListener('focus', function() {
            setTimeout(() => {
                updateHeaderStats();
                updateWorldStats();
            }, 100);
        });
        
        // ACTUALIZAR ESTAD√çSTICAS CUANDO CAMBIA EL LOCALSTORAGE
        window.addEventListener('storage', function(e) {
            if (e.key === 'memoflip_scores') {
                setTimeout(() => {
                    updateHeaderStats();
                    updateWorldStats();
                }, 100);
            }
        });
        
        // ACTUALIZAR ESTAD√çSTICAS PERI√ìDICAMENTE
        setInterval(() => {
            updateHeaderStats();
            updateWorldStats();
        }, UPDATE_CONFIG.STATS_UPDATE_INTERVAL);
        
        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // ESPERAR UN POCO PARA ASEGURAR QUE TODO EST√â CARGADO
            setTimeout(() => {
                updateHeaderStats();
                updateWorldStats();
            }, 100);
        });
        
        // Las funciones est√°n en world-selector.js
    </script>
    
    <!-- CABECERA UNIFICADA -->
    <script src="js/unified-header.js" defer></script>
    
    <!-- PWA Service Worker -->
  <script defer>
    if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
    }
  </script>
</body>
</html>
